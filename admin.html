<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم - مركز بانوراما للأشعة</title>
    
    <!-- Bootstrap RTL CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/custom.css">
    <style>
        .admin-sidebar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .admin-sidebar .nav-link {
            color: rgba(255,255,255,0.8);
            border-radius: 8px;
            margin: 2px 0;
            transition: all 0.3s ease;
        }
        .admin-sidebar .nav-link:hover,
        .admin-sidebar .nav-link.active {
            color: white;
            background: rgba(255,255,255,0.1);
            transform: translateX(-5px);
        }
        .admin-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
            margin-bottom: 1rem;
        }
        .text-main {
            color: #667eea !important;
        }
        .btn-main {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
        }
        .btn-main:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            color: white;
        }
        .logo-placeholder {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
        }
        .table th {
            background: #f8fafc;
            border-bottom: 2px solid #e5e7eb;
            font-weight: 600;
        }
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        .status-new { background: #dbeafe; color: #1e40af; }
        .status-confirmed { background: #dcfce7; color: #166534; }
        .status-completed { background: #f3e8ff; color: #7c3aed; }
        .status-cancelled { background: #fee2e2; color: #dc2626; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block admin-sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <div class="logo-placeholder mx-auto mb-2">
                            <i class="fas fa-x-ray"></i>
                        </div>
                        <h5 class="fw-bold">لوحة التحكم</h5>
                        <small class="text-light">مركز بانوراما للأشعة</small>
                    </div>
                    
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" onclick="showDashboard()">
                                <i class="fas fa-tachometer-alt me-2"></i>
                                الرئيسية
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showBookings()">
                                <i class="fas fa-calendar-check me-2"></i>
                                الحجوزات
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showContacts()">
                                <i class="fas fa-envelope me-2"></i>
                                رسائل التواصل
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showServices()">
                                <i class="fas fa-list me-2"></i>
                                الخدمات
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showDoctors()">
                                <i class="fas fa-user-md me-2"></i>
                                الأطباء
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showBlog()">
                                <i class="fas fa-blog me-2"></i>
                                المدونة
                            </a>
                        </li>
                        <li class="nav-item mt-4">
                            <a class="nav-link" href="/" target="_blank">
                                <i class="fas fa-external-link-alt me-2"></i>
                                عرض الموقع
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 admin-content">
                <!-- Dashboard -->
                <div id="dashboard-content">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">لوحة التحكم</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="btn-group me-2">
                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="refreshStats()">
                                    <i class="fas fa-sync-alt"></i> تحديث
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Statistics Cards -->
                    <div class="row g-4 mb-4">
                        <div class="col-xl-3 col-md-6">
                            <div class="stats-card">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="mb-2 opacity-75">إجمالي الحجوزات</h6>
                                        <h3 class="mb-0" id="total-bookings">0</h3>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-calendar-check" style="font-size: 2rem; opacity: 0.8;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6">
                            <div class="stats-card">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="mb-2 opacity-75">الحجوزات الجديدة</h6>
                                        <h3 class="mb-0" id="new-bookings">0</h3>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-clock" style="font-size: 2rem; opacity: 0.8;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6">
                            <div class="stats-card">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="mb-2 opacity-75">رسائل التواصل</h6>
                                        <h3 class="mb-0" id="total-contacts">0</h3>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-envelope" style="font-size: 2rem; opacity: 0.8;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6">
                            <div class="stats-card">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="mb-2 opacity-75">الخدمات المتاحة</h6>
                                        <h3 class="mb-0" id="total-services">0</h3>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-list" style="font-size: 2rem; opacity: 0.8;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Bookings -->
                    <div class="row">
                        <div class="col-12">
                            <div class="admin-card">
                                <h5 class="mb-3">آخر الحجوزات</h5>
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>الاسم</th>
                                                <th>الهاتف</th>
                                                <th>الخدمة</th>
                                                <th>التاريخ</th>
                                                <th>الحالة</th>
                                                <th>الإجراءات</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recent-bookings-table">
                                            <!-- Recent bookings will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bookings Content -->
                <div id="bookings-content" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">إدارة الحجوزات</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button type="button" class="btn btn-sm btn-main" onclick="exportBookings()">
                                <i class="fas fa-download me-2"></i>تصدير
                            </button>
                        </div>
                    </div>

                    <div class="admin-card">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>الاسم</th>
                                        <th>الهاتف</th>
                                        <th>الخدمة</th>
                                        <th>الطبيب</th>
                                        <th>التاريخ</th>
                                        <th>الوقت</th>
                                        <th>الحالة</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="bookings-table">
                                    <!-- Bookings will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Contacts Content -->
                <div id="contacts-content" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">رسائل التواصل</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button type="button" class="btn btn-sm btn-main" onclick="exportContacts()">
                                <i class="fas fa-download me-2"></i>تصدير
                            </button>
                        </div>
                    </div>

                    <div class="admin-card">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>الاسم</th>
                                        <th>البريد الإلكتروني</th>
                                        <th>الهاتف</th>
                                        <th>الموضوع</th>
                                        <th>التاريخ</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="contacts-table">
                                    <!-- Contacts will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Services Content -->
                <div id="services-content" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">إدارة الخدمات</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button type="button" class="btn btn-sm btn-main" onclick="showAddServiceModal()">
                                <i class="fas fa-plus me-2"></i>إضافة خدمة
                            </button>
                        </div>
                    </div>

                    <div class="admin-card">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>الصورة</th>
                                        <th>اسم الخدمة</th>
                                        <th>الوصف</th>
                                        <th>السعر</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="services-table">
                                    <!-- Services will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Doctors Content -->
                <div id="doctors-content" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">إدارة الأطباء</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button type="button" class="btn btn-sm btn-main" onclick="showAddDoctorModal()">
                                <i class="fas fa-plus me-2"></i>إضافة طبيب
                            </button>
                        </div>
                    </div>

                    <div class="admin-card">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>الصورة</th>
                                        <th>اسم الطبيب</th>
                                        <th>التخصص</th>
                                        <th>الخبرة</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="doctors-table">
                                    <!-- Doctors will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Blog Content -->
                <div id="blog-content" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">إدارة المدونة</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button type="button" class="btn btn-sm btn-main" onclick="showAddBlogModal()">
                                <i class="fas fa-plus me-2"></i>إضافة مقال
                            </button>
                        </div>
                    </div>

                    <div class="admin-card">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>الصورة</th>
                                        <th>عنوان المقال</th>
                                        <th>الكاتب</th>
                                        <th>التاريخ</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="blog-table">
                                    <!-- Blog posts will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add Service Modal -->
    <div class="modal fade" id="addServiceModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">إضافة خدمة جديدة</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addServiceForm">
                        <div class="mb-3">
                            <label class="form-label">اسم الخدمة</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">الوصف</label>
                            <textarea class="form-control" name="description" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">السعر</label>
                            <input type="number" class="form-control" name="price" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">صورة الخدمة</label>
                            <input type="file" class="form-control" name="image" accept="image/*">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-main" onclick="addService()">إضافة</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Doctor Modal -->
    <div class="modal fade" id="addDoctorModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">إضافة طبيب جديد</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addDoctorForm">
                        <div class="mb-3">
                            <label class="form-label">اسم الطبيب</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">التخصص</label>
                            <input type="text" class="form-control" name="specialization" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">سنوات الخبرة</label>
                            <input type="number" class="form-control" name="experience" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">صورة الطبيب</label>
                            <input type="file" class="form-control" name="image" accept="image/*">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-main" onclick="addDoctor()">إضافة</button>
                </div>
            </div>
        </div>
    </div>

    <!-- صفحة تسجيل الدخول للأدمن -->
    <div id="admin-login" style="max-width:400px;margin:60px auto;display:none;">
        <div class="admin-card">
            <h3 class="mb-4 text-center">تسجيل دخول الأدمن</h3>
            <form id="adminLoginForm" onsubmit="return adminLogin(event)">
                <div class="mb-3">
                    <label class="form-label">رقم الأدمن</label>
                    <input type="text" class="form-control" id="admin-username" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">كلمة المرور</label>
                    <input type="password" class="form-control" id="admin-password" required>
                </div>
                <button type="submit" class="btn btn-main w-100">دخول</button>
            </form>
            <div id="login-error" class="alert alert-danger mt-3 d-none"></div>
        </div>
    </div>

    <!-- مودال تعديل الخدمة -->
    <div class="modal fade" id="editServiceModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">تعديل الخدمة</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editServiceForm">
                        <input type="hidden" name="id" id="edit-service-id">
                        <div class="mb-3">
                            <label class="form-label">اسم الخدمة</label>
                            <input type="text" class="form-control" name="name" id="edit-service-name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">الوصف</label>
                            <textarea class="form-control" name="description" id="edit-service-description" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">السعر</label>
                            <input type="number" class="form-control" name="price" id="edit-service-price" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">صورة الخدمة</label>
                            <input type="file" class="form-control" name="image" id="edit-service-image" accept="image/*">
                            <img id="edit-service-preview" src="" alt="صورة الخدمة" style="width:60px;margin-top:10px;display:none;">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-main" onclick="saveEditService()">حفظ التعديلات</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="assets/js/custom.js"></script>
    <script>
        // Admin Panel JavaScript
        let currentSection = 'dashboard';

        function showDashboard() {
            hideAllSections();
            document.getElementById('dashboard-content').style.display = 'block';
            updateActiveNav('dashboard');
            loadDashboardData();
        }

        function showBookings() {
            hideAllSections();
            document.getElementById('bookings-content').style.display = 'block';
            updateActiveNav('bookings');
            loadBookings();
        }

        function showContacts() {
            hideAllSections();
            document.getElementById('contacts-content').style.display = 'block';
            updateActiveNav('contacts');
            loadContacts();
        }

        function showServices() {
            hideAllSections();
            document.getElementById('services-content').style.display = 'block';
            updateActiveNav('services');
            loadServices();
        }

        function showDoctors() {
            hideAllSections();
            document.getElementById('doctors-content').style.display = 'block';
            updateActiveNav('doctors');
            loadDoctors();
        }

        function showBlog() {
            hideAllSections();
            document.getElementById('blog-content').style.display = 'block';
            updateActiveNav('blog');
            loadBlogPosts();
        }

        function hideAllSections() {
            const sections = ['dashboard-content', 'bookings-content', 'contacts-content', 'services-content', 'doctors-content', 'blog-content'];
            sections.forEach(section => {
                document.getElementById(section).style.display = 'none';
            });
        }

        function updateActiveNav(section) {
            // Remove active class from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Add active class to current section
            const navLinks = document.querySelectorAll('.nav-link');
            const sectionIndex = ['dashboard', 'bookings', 'contacts', 'services', 'doctors', 'blog'].indexOf(section);
            if (sectionIndex >= 0 && navLinks[sectionIndex]) {
                navLinks[sectionIndex].classList.add('active');
            }
        }

        function loadDashboardData() {
            // Load statistics
            fetch('/api/stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('total-bookings').textContent = data.total_bookings || 0;
                    document.getElementById('new-bookings').textContent = data.new_bookings || 0;
                    document.getElementById('total-contacts').textContent = data.total_contacts || 0;
                    document.getElementById('total-services').textContent = data.total_services || 0;
                })
                .catch(error => {
                    console.error('Error loading stats:', error);
                });

            // Load recent bookings
            loadRecentBookings();
        }

        function loadRecentBookings() {
            fetch('/api/bookings?limit=5')
                .then(response => response.json())
                .then(data => {
                    const table = document.getElementById('recent-bookings-table');
                    table.innerHTML = '';
                    
                    data.forEach(booking => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${booking.name}</td>
                            <td>${booking.phone}</td>
                            <td>${booking.service}</td>
                            <td>${new Date(booking.date).toLocaleDateString('ar-SA')}</td>
                            <td><span class="status-badge status-${booking.status}">${getStatusText(booking.status)}</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="viewBooking(${booking.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        `;
                        table.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error loading recent bookings:', error);
                });
        }

        function loadBookings() {
            fetch('/api/bookings')
                .then(response => response.json())
                .then(data => {
                    const table = document.getElementById('bookings-table');
                    table.innerHTML = '';
                    
                    data.forEach(booking => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${booking.name}</td>
                            <td>${booking.phone}</td>
                            <td>${booking.service}</td>
                            <td>${booking.doctor || '-'}</td>
                            <td>${new Date(booking.date).toLocaleDateString('ar-SA')}</td>
                            <td>${booking.time}</td>
                            <td><span class="status-badge status-${booking.status}">${getStatusText(booking.status)}</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary me-1" onclick="viewBooking(${booking.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-success me-1" onclick="updateBookingStatus(${booking.id}, 'confirmed')">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteBooking(${booking.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
                        table.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error loading bookings:', error);
                });
        }

        function loadContacts() {
            fetch('/api/contacts')
                .then(response => response.json())
                .then(data => {
                    const table = document.getElementById('contacts-table');
                    table.innerHTML = '';
                    
                    data.forEach(contact => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${contact.name}</td>
                            <td>${contact.email}</td>
                            <td>${contact.phone}</td>
                            <td>${contact.subject}</td>
                            <td>${new Date(contact.date).toLocaleDateString('ar-SA')}</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary me-1" onclick="viewContact(${contact.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteContact(${contact.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
                        table.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error loading contacts:', error);
                });
        }

        function loadServices() {
            fetch('/api/services')
                .then(response => response.json())
                .then(data => {
                    const table = document.getElementById('services-table');
                    table.innerHTML = '';
                    
                    data.forEach(service => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>
                                <img src="${service.image || 'assets/images/placeholder.jpg'}" alt="${service.name}" 
                                     style="width: 50px; height: 50px; object-fit: cover; border-radius: 8px;">
                            </td>
                            <td>${service.name}</td>
                            <td>${service.description.substring(0, 100)}...</td>
                            <td>${service.price} ريال</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary me-1" onclick="showEditServiceModal(${service.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteService(${service.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
                        table.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error loading services:', error);
                });
        }

        function loadDoctors() {
            fetch('/api/doctors')
                .then(response => response.json())
                .then(data => {
                    const table = document.getElementById('doctors-table');
                    table.innerHTML = '';
                    
                    data.forEach(doctor => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>
                                <img src="${doctor.image || 'assets/images/placeholder.jpg'}" alt="${doctor.name}" 
                                     style="width: 50px; height: 50px; object-fit: cover; border-radius: 8px;">
                            </td>
                            <td>${doctor.name}</td>
                            <td>${doctor.specialization}</td>
                            <td>${doctor.experience} سنوات</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary me-1" onclick="editDoctor(${doctor.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteDoctor(${doctor.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
                        table.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error loading doctors:', error);
                });
        }

        function loadBlogPosts() {
            fetch('/api/blog')
                .then(response => response.json())
                .then(data => {
                    const table = document.getElementById('blog-table');
                    table.innerHTML = '';
                    
                    data.forEach(post => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>
                                <img src="${post.image || 'assets/images/placeholder.jpg'}" alt="${post.title}" 
                                     style="width: 50px; height: 50px; object-fit: cover; border-radius: 8px;">
                            </td>
                            <td>${post.title}</td>
                            <td>${post.author}</td>
                            <td>${new Date(post.date).toLocaleDateString('ar-SA')}</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary me-1" onclick="editBlogPost(${post.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteBlogPost(${post.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
                        table.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error loading blog posts:', error);
                });
        }

        function getStatusText(status) {
            const statusMap = {
                'new': 'جديد',
                'confirmed': 'مؤكد',
                'completed': 'مكتمل',
                'cancelled': 'ملغي'
            };
            return statusMap[status] || status;
        }

        function refreshStats() {
            loadDashboardData();
        }

        function showAddServiceModal() {
            const modal = new bootstrap.Modal(document.getElementById('addServiceModal'));
            modal.show();
        }

        function showAddDoctorModal() {
            const modal = new bootstrap.Modal(document.getElementById('addDoctorModal'));
            modal.show();
        }

        function showAddBlogModal() {
            // Implementation for blog modal
            alert('سيتم إضافة هذه الميزة قريباً');
        }

        function addService() {
            const form = document.getElementById('addServiceForm');
            const formData = new FormData(form);
            
            fetch('/api/services', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    bootstrap.Modal.getInstance(document.getElementById('addServiceModal')).hide();
                    form.reset();
                    loadServices();
                    alert('تم إضافة الخدمة بنجاح');
                } else {
                    alert('حدث خطأ أثناء إضافة الخدمة');
                }
            })
            .catch(error => {
                console.error('Error adding service:', error);
                alert('حدث خطأ أثناء إضافة الخدمة');
            });
        }

        function addDoctor() {
            const form = document.getElementById('addDoctorForm');
            const formData = new FormData(form);
            
            fetch('/api/doctors', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    bootstrap.Modal.getInstance(document.getElementById('addDoctorModal')).hide();
                    form.reset();
                    loadDoctors();
                    alert('تم إضافة الطبيب بنجاح');
                } else {
                    alert('حدث خطأ أثناء إضافة الطبيب');
                }
            })
            .catch(error => {
                console.error('Error adding doctor:', error);
                alert('حدث خطأ أثناء إضافة الطبيب');
            });
        }

        function exportBookings() {
            fetch('/api/export/bookings')
                .then(response => response.blob())
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'bookings.csv';
                    a.click();
                })
                .catch(error => {
                    console.error('Error exporting bookings:', error);
                    alert('حدث خطأ أثناء تصدير البيانات');
                });
        }

        function exportContacts() {
            fetch('/api/export/contacts')
                .then(response => response.blob())
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'contacts.csv';
                    a.click();
                })
                .catch(error => {
                    console.error('Error exporting contacts:', error);
                    alert('حدث خطأ أثناء تصدير البيانات');
                });
        }

        // بيانات الأدمن (يمكن تعديلها لاحقًا)
        const ADMIN_USER = 'admin';
        const ADMIN_PASS = '123456';

        function isAdminLoggedIn() {
            return localStorage.getItem('admin_logged_in') === '1';
        }
        function showAdminLogin() {
            document.getElementById('admin-login').style.display = 'block';
            document.querySelector('.container-fluid').style.display = 'none';
        }
        function showAdminPanel() {
            document.getElementById('admin-login').style.display = 'none';
            document.querySelector('.container-fluid').style.display = 'block';
        }
        function adminLogin(e) {
            e.preventDefault();
            const user = document.getElementById('admin-username').value;
            const pass = document.getElementById('admin-password').value;
            if (user === ADMIN_USER && pass === ADMIN_PASS) {
                localStorage.setItem('admin_logged_in', '1');
                showAdminPanel();
            } else {
                document.getElementById('login-error').textContent = 'بيانات الدخول غير صحيحة';
                document.getElementById('login-error').classList.remove('d-none');
            }
            return false;
        }
        function adminLogout() {
            localStorage.removeItem('admin_logged_in');
            location.reload();
        }
        // عند تحميل الصفحة
        window.addEventListener('DOMContentLoaded', function() {
            if (!isAdminLoggedIn()) {
                showAdminLogin();
            } else {
                showAdminPanel();
            }
        });
    </script>
</body>
</html> 